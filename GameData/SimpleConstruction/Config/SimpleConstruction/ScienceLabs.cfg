// ScienceLabs.cfg v1.0.5.0
// SimpleConstruction! (SCON)
// created: 01 Dec 2019
// updated: 30 Sep 2022

// GPL-3.0 by zer0Kerbal

// the issue appears to be the SC patch is looking for all parts that have a 
// MODULE[ModuleScienceLab], which Kerbalism deleted and replaces with 
// MODULE[Laboratory] (and other stuff); _i.e._ the SC patch finds no parts 
// fulfilling it's :NEEDS and does nothing.

// three ways to handle fixing for Kerbalism:
// 1. patch before KerbalismDefault
// 	use :FIRST or :BEFORE
// 2. patch after
// 	look for MODULE[Laboratory]
// 3. or look for either module

// @PART[*]:HAS[@MODULE[ModuleScienceLab|Laboratory]]:NEEDS[LaunchPad,SimpleConstruction,]:FOR[SimpleConstruction]
// @PART[*]:HAS[@MODULE[ModuleScienceLab]|MODULE[Laboratory]]:NEEDS[LaunchPad,SimpleConstruction,]:FOR[SimpleConstruction]


@PART[*]:HAS[@MODULE[ModuleScienceLab]]:NEEDS[LaunchPad,SimpleConstruction,!KerbalismDefault]:FOR[SimpleConstruction]
{
	MODULE
	{
		name = ModuleResourceConverter
		ConverterName = #EL_RocketParts-name // RocketParts
		StartActionName = #EL_EventGUIName_StartPartProduction // Start Part Production
		StopActionName = #EL_EventGUIName_StopPartProduction // Stop Part Production

		AutoShutdown = false
		UseSpecialistBonus = true
		SpecialistEfficiencyFactor = 0.2
		SpecialistBonusBase = 0.05
		Specialty = Engineer
		EfficiencyBonus = 1

		INPUT_RESOURCE
		{
			ResourceName = Metal
			Ratio = 0.25
			FlowMode = STAGE_PRIORITY_FLOW
		}
		
		INPUT_RESOURCE
		{
			ResourceName = ElectricCharge
			Ratio = 30
		}
		
		OUTPUT_RESOURCE
		{
			ResourceName = RocketParts
			Ratio = 0.25
			DumpExcess = false
			FlowMode = STAGE_PRIORITY_FLOW
		}
	}

	MODULE
	{
		name = ELWorkshop
		ProductivityFactor = 7
		FullyEquipped = true
	}
	
	RESOURCE
	{
		name = Metal
		amount = 0
		maxAmount = 10
	 }
	 
	RESOURCE
	{
		name = RocketParts
		amount = 0
		maxAmount = 10
	 }
}

@PART[*]:HAS[@MODULE[ModuleScienceLab]]:NEEDS[LaunchPad,SimpleConstruction,KerbalismDefault]:AFTER[KerbalismDefault]
{
	MODULE
	{
		name = ModuleResourceConverter
		ConverterName = #EL_RocketParts-name // RocketParts
		StartActionName = #EL_EventGUIName_StartPartProduction // Start Part Production
		StopActionName = #EL_EventGUIName_StopPartProduction // Stop Part Production

		AutoShutdown = false
		UseSpecialistBonus = true
		SpecialistEfficiencyFactor = 0.2
		SpecialistBonusBase = 0.05
		Specialty = Engineer
		EfficiencyBonus = 1

		INPUT_RESOURCE
		{
			ResourceName = Metal
			Ratio = 0.25
			FlowMode = STAGE_PRIORITY_FLOW
		}
		
		INPUT_RESOURCE
		{
			ResourceName = ElectricCharge
			Ratio = 30
		}
		
		OUTPUT_RESOURCE
		{
			ResourceName = RocketParts
			Ratio = 0.25
			DumpExcess = false
			FlowMode = STAGE_PRIORITY_FLOW
		}
	}

	MODULE
	{
		name = ELWorkshop
		ProductivityFactor = 7
		FullyEquipped = true
	}
	
	RESOURCE
	{
		name = Metal
		amount = 0
		maxAmount = 10
	 }
	 
	RESOURCE
	{
		name = RocketParts
		amount = 0
		maxAmount = 10
	 }
}